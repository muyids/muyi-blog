## 字符串

实现：

- 简单动态字符串 SDS
- 结构体： 长度 len，未使用长度 free，字符数组 char[] buf
  性能优势：

- O(1)获取长度

- 减少空间分配次数 提升内存使用效率

  - 空间预分配
  - 惰性空间回收

## bitmap

1byte = 8 bit

优势：

- 基于 SDS 实现
- 位图 可以节约空间，基于 bit 存储
- 效率高，写入时间复杂度 O(1)、读取时间复杂度 O(n)
- 计算非常快，二进制数据的存储
- 方便扩容

限制：

- 字符串最大 512M， 所以 bit 映射最大在 2^32 位
- 读取时候时间复杂度 O(n)，越大的串读的时间花销越多，最好限制每个 key 的位数在 20 以下，即 100 万进行分片
  - 在一台 2010MacBook Pro 上，offset 为 232-1（分配 512MB）需要～ 300ms，offset 为 230-1(分配 128MB)需要～ 80ms，offset 为 228-1（分配 32MB）需要～ 30ms，offset 为 226-1（分配 8MB）需要 8ms。<来自官方文档>

命令：

- setbit : 给一个指定 key 的值得第 offset 位 赋值为 value。
- getbit : 返回一个指定 key 的二进制信息
- Bitcount : 返回一个指定 key 中位的值为 1 的个数(问题点：是以 byte 为单位不是 bit)
- Bitop : 对不同的二进制存储数据进行位运算(AND、OR、NOT、XOR)
  场景：

- 签到：Bitcount 统计一个月签到数，bitop and 统计连续签到人数
- 用户在线状态：统计在线总数
