**滑动窗口**

时间窗口 计数

缺点：

1、时间分片的大小决定限流的精度

2、无法解决瞬时流量的问题

**漏斗**

漏斗里保存的是请求，一边加请求，一边出，通过计算加入和流出的请求差，判断漏斗是否溢出

Redis 中提供的一个限流 Redis 模块：redis-cell ，该模块使用漏斗算法并提供原子性的限流指令

漏桶算法有一个明显的缺陷：

当短时间内有大量的突发请求时，即使服务器负载不高，每个请求也都得在队列中等待一段时间才能被响应。

**令牌桶**

谷歌开源项目 Guava （瓜哇）中的 RateLimiter 使用的限流算法就是令牌桶限流算法。

桶里保存的是令牌

![外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-6wjO2zbx-1597314262640)(8073286099404446B8CA61C5C4D628B7)](https://muyids.oss-cn-beijing.aliyuncs.com/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0NTI4Mjk3,size_16,color_FFFFFF,t_70.png)

1. 以恒定的速度生成令牌并将令牌加到一个桶里，如果桶满了将其丢弃
2. 每个请求进来时都会到桶里拿一个令牌，如果没拿到（桶里没有令牌）拒绝该请求，若拿到则正常执行

### 四种策略该如何选择

- 固定窗口：实现简单，但是过于粗暴，除非情况紧急，为了能快速止损眼前的问题可以作为临时应急的方案。
- 滑动窗口：限流算法简单易实现，可以应对有少量突增流量场景。
- 漏桶：对于流量绝对均匀有很强的要求，资源的利用率上不是极致，但其宽进严出模式，保护系统的同时还留有部分余量，是一个通用性方案。
- 令牌桶：系统经常有突增流量，并尽可能的压榨服务的性能。
