## git hook

```shell
tree -L 2 .git/hooks
.git/hooks
â”œâ”€â”€ applypatch-msg.sample
â”œâ”€â”€ commit-msg.sample
â”œâ”€â”€ fsmonitor-watchman.sample
â”œâ”€â”€ post-update.sample
â”œâ”€â”€ pre-applypatch.sample
â”œâ”€â”€ pre-commit.sample
â”œâ”€â”€ pre-merge-commit.sample
â”œâ”€â”€ pre-push.sample
â”œâ”€â”€ pre-rebase.sample
â”œâ”€â”€ pre-receive.sample
â”œâ”€â”€ prepare-commit-msg.sample
â””â”€â”€ update.sample

```

git æ‰§è¡Œå¯¹åº”æ“ä½œæ—¶ï¼Œå°±ä¼šè§¦å‘å“åº”çš„ hook

æ¯”å¦‚ git commit å‰ä¼šè§¦å‘ pre-commitï¼Œå¡«å†™ commit ä¿¡æ¯æ—¶ï¼Œä¼šè§¦å‘ commit-msg

æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥ å¤åˆ¶ commit-msg.sample æˆ commit-msgï¼Œå¹¶ä¿®æ”¹å…¶ä¸­çš„å†…å®¹ï¼Œå¯¹è¿›è¡Œ commit çš„ä¿¡æ¯è¿›è¡Œå®šåˆ¶åŒ–ä¿®æ”¹ï¼›æ¯”å¦‚ï¼Œå¢åŠ  commit çš„é¡¹ç›®ç‰ˆæœ¬å·ã€åˆå§‹åˆ†æ”¯ç­‰ï¼›

### commit-msg æ·»åŠ å‰ç¼€

ä¸ºäº†æ›´å¥½çš„ç‰ˆæœ¬ç®¡ç†ï¼Œå°ç»„å†…åˆ¶å®šäº† commit-message çš„å›ºå®šæ ¼å¼ï¼š

```shell
[ç³»ç»Ÿå˜æ›´å·]_åˆ†æ”¯å_{COMMIT_MESSAGE}
```

æ–°å¢æ–‡ä»¶ï¼šã€.git/hooks/commit-msgã€‘

```shell
#!/bin/sh
set -ex
# è·å–å½“å‰å˜æ›´å·ï¼ˆå˜æ›´å·å­˜æ”¾åœ¨æ ¹ç›®å½•versionæ–‡ä»¶å†…ï¼Œå…·ä½“ä½ç½®æ ¹æ®è‡ªå·±æƒ…å†µï¼‰
# æ¯ä¸ªåˆ†æ”¯éƒ½æœ‰ç‹¬ç«‹ä¸”å›ºå®šçš„ç³»ç»Ÿå˜æ›´å·ï¼Œæ‰€ä»¥æ­¤å¤„ä»¥æ–‡ä»¶æ ¼å¼å­˜æ”¾åœ¨ä»£ç ç›®å½•
# åˆå¹¶çš„æ—¶å€™å¯èƒ½æœ‰å†²çªï¼Œå¤„ç†ä¸€æ¬¡å°±å¥½
version=$(head -n +1 version)
# è·å–å½“å‰åˆ†æ”¯
line=$(head -n +1 .git/HEAD)
branch=${line##*/}
commit=[${version}]_${branch}_$(cat $1)
echo "$commit" > "$1"
```

## husky

https://github.com/typicode/husky

husky ä½¿ä½ çš„ git commit å¼•æ¥æ›´å¤šçš„ ğŸ¶ å«

### å¿«é€Ÿå¼€å§‹

å®‰è£…ä¾èµ–

npm install husky -D

ç”Ÿæˆ .husky(install husky Git hooks )

```javascript
npm set-script prepare "husky install"
npm run prepare
```

Add pre-commit hook

```javascript
npx husky add .husky/pre-commit "npm test"
git add .husky/pre-commit
```

### ä»£ç æäº¤å‰æ£€æŸ¥

ä¸€èˆ¬ç”¨äºæäº¤å‰çš„æ£€æŸ¥ï¼Œæ¯”å¦‚ä»£ç æ ¼å¼ï¼Œæµ‹è¯•ç”¨ä¾‹æ ¡éªŒç­‰

#### ä»£ç æ ¼å¼æ ¡éªŒ - lint-staged

https://github.com/okonet/lint-staged

ä¾èµ– eslint

å‚è€ƒ https://eslint.org/docs/user-guide/getting-started è¿›è¡Œé…ç½®

```
npm install eslint --save-dev
```

#### è¿è¡Œæµ‹è¯•ç”¨ä¾‹ - TODO

### Commit æäº¤ä¿¡æ¯æ£€æŸ¥

https://github.com/conventional-changelog/commitlint

#### å¿«é€Ÿå¼€å§‹

1ã€å®‰è£…ä¾èµ–

```
npm install --save-dev @commitlint/{config-conventional,cli}
```

2ã€add commit-msg hook

```
npx husky add .husky/commit-msg 'npx --no -- commitlint --edit "$1"'
```

ç”Ÿæˆ commit-msg æ–‡ä»¶

```
#!/bin/sh
set -ex

. "$(dirname "$0")/_/husky.sh"

npx --no -- commitlint --edit "$1"
```

commitlint.config.js

```
module.exports = {
  extends: ['@commitlint/config-conventional'],
  enableMultipleScopes: true,
};
```

æ”¯æŒ Prompt

### Commit æäº¤ä¿¡æ¯è‡ªå®šä¹‰

package.json

```
  "scripts": {
    "commit": "git-cz"
    },
  "config": {
    "commitizen": {
      "path": "node_modules/cz-customizable"
    }
  },
   "cz-customizable": {
    "config": ".cz-config.js"
  },
```

commitlint.config.js

```
module.exports = {
  extends: ['cz'], // '@commitlint/config-conventional'

  enableMultipleScopes: true,

};
```

.cz-config.js

```javascript
module.exports = {
  types: [
    { value: "featâœ¨", name: "ç‰¹æ€§: ä¸€ä¸ªæ–°çš„ç‰¹æ€§" },
    { value: "fixğŸ", name: "ä¿®å¤: ä¿®å¤ä¸€ä¸ªBug" },
    { value: "docsğŸ“š", name: "æ–‡æ¡£: å˜æ›´çš„åªæœ‰æ–‡æ¡£" },
    { value: "styleğŸ’…", name: "æ ¼å¼: ç©ºæ ¼, åˆ†å·ç­‰æ ¼å¼ä¿®å¤" },
    { value: "refactorğŸ› ", name: "é‡æ„: ä»£ç é‡æ„ï¼Œæ³¨æ„å’Œç‰¹æ€§ã€ä¿®å¤åŒºåˆ†å¼€" },
    { value: "perfğŸ", name: "æ€§èƒ½: æå‡æ€§èƒ½" },
    { value: "testğŸ", name: "æµ‹è¯•: æ·»åŠ ä¸€ä¸ªæµ‹è¯•" },
    { value: "revertâª", name: "å›æ»š: ä»£ç å›é€€" },
    { value: "choreğŸ—¯", name: "å·¥å…·:å¼€å‘å·¥å…·å˜åŠ¨(æ„å»ºã€è„šæ‰‹æ¶å·¥å…·ç­‰)" },
  ],
  messages: {
    type: "é€‰æ‹©ä¸€ç§ä½ çš„æäº¤ç±»å‹:",
    customScope: "è¯·è¾“å…¥ä¿®æ”¹èŒƒå›´(å¯é€‰):",
    subject: "çŸ­è¯´æ˜:",
    body: 'é•¿è¯´æ˜ï¼Œä½¿ç”¨"|"æ¢è¡Œ(å¯é€‰)ï¼š',
    footer: "å…³è”å…³é—­çš„issueï¼Œä¾‹å¦‚ï¼š#31, #34(å¯é€‰):",
    confirmCommit: "ç¡®å®šæäº¤è¯´æ˜?",
  },
  allowCustomScopes: true,
  allowBreakingChanges: ["ç‰¹æ€§", "ä¿®å¤"],
  subjectLimit: 100,
};
```
