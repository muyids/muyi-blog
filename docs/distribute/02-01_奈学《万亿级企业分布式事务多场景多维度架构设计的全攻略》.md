## 分布式事务架构设计哲学本质

同步、异步业务等多维度场景案例

- 一次请求涉及数据分布多个存储系统
  - 多个 DB
  - DB 和 cache
  - DB 和 MQ
  - DB 和 ES
  - 。。。
- 业务场景容忍度
  - 商品购买
    - 商品库存、订单、支付
  - 朋友圈发布信息
    - 发布信息，朋友圈的小红点

CAP -> AP ? CP ? 取决于业务场景容忍度

- 业务场景分类

  - 商品购买

    - 同步场景

      减库存、建立订单

  - 异步场景 - 前台超时未支付
    对于一个业务，往往是 **同步 + 异步** 两种场景的结合，比如用户注册，商品下单等

## 分布式事务架构设计与实践普适方法论

架构：

- 90%以上解决的是**耦合**问题
- 解决耦合问题的唯一方案： **拆分**
- 最终目标：高内聚低耦合

![2021-07-20 pm2.14.02](https://muyids.oss-cn-beijing.aliyuncs.com/2021-07-20 pm2.14.02.png)

- 分布式事务普适方法论
  - 拆分
    - 分布式事务 -> 长事务
    - 本地事务 -> 短事务
    - 长事务 拆分成 多个短事务
  - 协调（补偿）
    - A->B->C
      - A、B 成功，C 失败
        - C 不需要补偿
        - 补偿 B 和 A（逆向）
