#### 用户模块

**注册**

- 用户账号、姓名、密码

**登录功能**

- 账号 + 密码 -> 登录

- 登录成功>下发 token

**退出登录**

- 服务端删除 session，客户端删 cookie

**修改密码**

- token + 旧密码 + 新密码
- 新密码格式校验
- 旧密码校验
- 清 cookie,session
  **用户列表**

- 支持分页
- 检索条件支持：用户名，手机号，邮箱，性别
  **编辑用户角色**（TODO）

角色分类：超级管理员、管理员、归档人员、普通用户

推荐的角色设计方案：

超级管理员：应用的创建者，拥有一切权限，只有应用的超级管理员能够任命管理员（创建应用时自动任命）

管理员：应用的管理员，可以操作管理应用下的用户、角色、权限（手动创建该角色）

归档人员：可以进行归档操作（手动创建该角色）

普通用户：只读权限，不可以进行文档修改（手动创建该角色）

**过滤器**

- JWT 校验过滤器
- 鉴权过滤器(TODO)

---

#### **预归档管理**

**文档管理**

文档列表

- 属性：序号、档号、文号、题名、责任人、全宗名称、卷宗级别、保管期限、年份、归档日期、页数、密级、备注

- 支持分页

操作：

- 新增
- 预览
- 编辑
- 归档
- 删除
- 批量新增
- 批量上传文件
- 单个上传文件
- 检索

检索功能：

- 支持条件：全宗名称、年度、责任人、题名等条件进行筛选
- 支持分页
  **新增**

序号：自增？

档号：前端录入？

文号：前端录入？

题名：前端录入

责任人：前端录入

全宗名称：前端录入

卷宗级别：枚举类型？前端录入？如果选择“卷级”，多一个选项“绑定件级”。

保管期限：前端录入，单位（天？年？）

年份：前端录入

归档日期：前端录入

页数：前端录入

密级：枚举类型？值？前端录入

备注：前端录入

状态：预归档

入库+同步 es

**预览**

点击“预览”，页面跳转到预览页面。上方展示字段名称：下方展示扫描件（PDF）

返回前端文件流或 cdn

#### 编辑

入库+同步 es

#### 归档

修改文档状态为已归档

#### 删除

修改文档状态为已删除

**批量新增**

上传 excel

**批量上传文件**

点击“批量上传文件”，上传 zip 压缩包（压缩包内文件夹就是一个卷宗），后台解析，批量匹配预归档数据

#### 上传单个卷宗

点击“上传单个卷宗”，上传 zip 压缩包或者多张图片（压缩包内文件就是一个卷宗），后台解析，匹配当前这条预归档数据。

**文档统计**

---

#### 档案管理

**档案管理**

**重新归档**

数据回归到预归档管理中，

修改状态：预归档

#### 借阅

弹窗选择借阅人，借阅成功后，“借阅按钮”置灰，不可再点击

#### 销毁

销毁本条数据

修改状态：已销毁

#### 高级管理

**角色管理**

属性：序号、角色名称、创建时间、备注

支持功能：

- 新增
- 编辑
  - 支持角色名称编辑
  - 支持权限增删操作
- 删除（用户已拥有角色不可删除）
- 查询（支持分页）
  **用户管理**

属性：序号、用户 ID、用户账号、姓名、角色、状态

支持功能：参考用户模块

**权限管理**

（TODO）

属性：序号、权限名称、资源、所属应用 id、父权限 id

支持功能：

- 新增
- 编辑
- 删除

---

排期

- 功能模块设计

- 接口设计
- 模块开发
  - 用户角色权限接口开发
  - 文档管理基本增删改查
  - 批量上传，卷宗压缩包解析
- 服务部署
  - docker 容器编排
  - 前后端环境部署

---

报价

- 人工开发费用

- 服务器费用(甲方提供？)

---

**档案信息表(archives)**

简介：档案信息表结构设计

| 字段                | 类型          | 说明                                                                      |
| :------------------ | :------------ | :------------------------------------------------------------------------ |
| id                  | bigint(16)    | 序号，数据库主键，生成规则暂定自增                                        |
| Create_time         | Datetime      | 创建时间                                                                  |
| update_time         | Datetime      | 更新时间                                                                  |
| Deleted_at          | bigint(16)    | 逻辑删除                                                                  |
| document_id         | bigint(16)    | 档号（可能是 uuid）                                                       |
| Article_id          | varchar(128)  | 文号                                                                      |
| Title               | varchar(256)  | 题名                                                                      |
| person              | varchar(64)   | 责任人                                                                    |
| archive_name        | varchar(256)  | 卷宗名称                                                                  |
| archive_level       | int(2)        | 卷宗级别（1:卷级;2:件级）                                                 |
| Storage_days        | Int(5)        | 保管期限（期限时长，单位天）                                              |
| Storage_end         | Datetime      | 保管期限（截止日期）                                                      |
| Year                | int(4)        | 年份                                                                      |
| archived_time       | Datetime      | 归档日期                                                                  |
| Pages               | int(3)        | 页数                                                                      |
| Secreat_level       | int(2)        | 密级                                                                      |
| remark              | varchar(1024) | 备注                                                                      |
| 待定字段            |               | 下面的字段为待定字段                                                      |
| parent_id           | bigint(16)    | 件级文件保存卷级文件 id，<br />实现文件继承关系<br />（卷级此字段值为-1） |
| Status              | int(2)        | 档案状态（1:预归档；2：归档；3：删除。。。）                              |
| Zip_file            | varchar(256)  | 上传压缩文件保存地址                                                      |
| archived_pdf        | varchar(256)  | 当前卷归档后的 pdf 文件地址                                               |
| archived_pdf_remote | varchar(256)  | pdf 远程上传地址                                                          |
| archived_pdf_bak    | varchar(256)  | pdf 备份地址                                                              |

**批处理任务信息表(batch_tasks)**

| 字段        | 类型         | 说明                               |
| :---------- | :----------- | :--------------------------------- |
| id          | bigint(16)   | 序号，数据库主键，生成规则暂定自增 |
| Create_time | Datetime     | 创建时间                           |
| update_time | Datetime     | 更新时间                           |
| Deleted_at  | bigint(16)   | 逻辑删除                           |
| batch_id    | varchar(128) | 批任务 id，生成规则 UUID           |
| user_id     | bigint(16)   | 创建者用户 id                      |
