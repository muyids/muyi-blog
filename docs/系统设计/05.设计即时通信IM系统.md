https://juejin.cn/post/6844904039038058504

https://zhuanlan.zhihu.com/p/409927117

以设计 weibo 为例，4s 分析法解决

## Scenario 场景

询问面试官

1. 需要设计哪些功能（也可以自己想）
2. 需要承受多大的访问量？

## Service 服务

将大系统拆分为小服务

1. Replay 重放需求
2. Merge 归并需求

## Storage 存储

内存
某些数据不需要持久化，直接内存保存就可以
数据库
存储结构化的数据
分为 关系型数据和非关系型数据，如何做选择？

文件系统
分布式文件系统，存储非结构化的数据，比如图片、视频等

1. 为每个 Service 选择存储结构
2. Schema 细化表结构

# 设计 twitter

设计朋友圈、微博

## 场景分析 Senario

功能：

1. 发推，发帖
2. 获取自己和关注的人的帖子
3. 关注某人
4. 取关某人

## 服务分析 Service

拆成两个服务，用户服务和帖子服务

### 用户服务

用户有关注和取关别人的功能

### 帖子服务

发帖功能

获取某人和关注的人最近的帖子

## 存储分析 Storage

用户关注关系 存储到 set 集合（或 hashTable），同时记录`关注了谁`和`被谁关注`两个集合

每个用户的发帖记录 存储到 链表（或 zset）

每个用户的最新帖子列表用大顶堆（按发帖时间倒序），堆元素为帖子（帖子 id, 发帖人 id, 发帖时间）；

维护最新帖子列表：

- 当用户发帖时，帖子加入到大顶堆；当用户删帖时，记录帖子被删除状态；
- 当用户关注某人时，将此人的帖子加入到大顶堆；
