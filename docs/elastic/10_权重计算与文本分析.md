https://blog.csdn.net/qq_35423154/article/details/119516738

# 权重计算原理

在 Elasticsearch 中，每个文档都有相关性评分，用一个正浮点数字段 `_score` 来表示 。 `_score` 的评分越高，相关性越高。为了保证搜索到的结果相关度更高，在默认情况下返回结果会按照相关度降序排序。

Elasticsearch 使用**布尔模型**查找匹配文档，并用一个名为**实用评分函数**的公式来计算相关度。这个公式借鉴了**词频/逆向文档频率**和**向量空间模型**，同时也加入了一些现代的新特性，如**协调因子**，**字段长度归一化**，以及**词或查询语句权重提升**。

## 布尔模型

布尔模型（Boolean Model） 适用于在查询中使用 AND 、 OR 和 NOT （与、或、非）这样的条件来查找匹配的文档，如以下查询：

```
full AND text AND search AND (elasticsearch OR lucene)
```

会将所有包括词 full 、 text 和 search ，以及 elasticsearch 或 lucene 的文档作为结果集。

这个过程简单且快速，它将所有可能不匹配的文档排除在外。

## 词频/逆向文档频率（TF/IDF）

### **检索词频率**

Term Frequency

**检索词在该字段出现的频率**。出现频率越高，相关性也越高。5 次提到同一词的字段比只提到 1 次的更相关。

计算方式：

$tf(t in d) = √frequency$

### **逆向文档频率**

Reverse document frequency

**每个检索词在索引中出现的频率**。频率越高，相关性越低。检索词出现在多数文档中会比出现在少数文档中的权重更低。

计算方式：

$idf(t) = 1 + log ( numDocs / (docFreq + 1))$

### **字段长度归一值**

**字段的长度**。长度越长，相关性越低。 检索词出现在一个短的 title 要比同样的词出现在一个长的 content 字段权重更大。

字段长度的归一值公式

$norm(d) = 1 / √numTerms$

字段长度归一值（ `norm` ）是字段中词数平方根的倒数。

## 向量空间模型

# 文本分析

## 分析与分析器

### 分析包含以下两个流程：

1. 将一块文本分成适合于倒排索引的独立的词条
2. 将这些词条统一化为标准格式以提高它们的可搜索性，或者 recall
   分析器执行上面的工作。 分析器实际上是将三个功能封装到了一个包里：

3. 字符过滤器：字符串按顺序通过每个字符过滤器 。他们的任务是在分词前整理字符串。一个字符过滤器可以用来去掉 HTML，或者将 & 转化成 and。
4. 分词器：字符串被分词器拆分为单个的词条。一个简单的分词器遇到空格和标点的时候，可能会将文本拆分成词条。
